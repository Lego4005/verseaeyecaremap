<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <title>Versea EyeCare</title>
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css' rel='stylesheet' />
    <style>
      body { 
        margin: 0; 
        padding: 0; 
      }
      #map { 
        position: absolute; 
        top: 0; 
        bottom: 0; 
        width: 100%; 
      }
    </style>
  </head>
  <body>
    <div id='map'></div>
    <div style="position: absolute; z-index: 1; padding: 10px;">
      <label>
        <input type="checkbox" class="equity-toggle" value="AEG" checked>
        AEG
      </label>
      <label>
        <input type="checkbox" class="equity-toggle" value="ECP" checked>
        ECP
      </label>
      <label>
        <input type="checkbox" class="equity-toggle" value="ESP" checked>
        ESP
      </label>
      <label>
        <input type="checkbox" class="equity-toggle" value="BCP" checked>
        BCP
      </label>
      <label>
        <input type="checkbox" class="equity-toggle" value="ECSP" checked>
        ECSP
      </label>
      <label>
        <input type="checkbox" class="equity-toggle" value="WPO" checked>
        WPO
      </label>
    </div>
    <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiY29sYnlmb3giLCJhIjoiY2xlNmJhMWxyMGE5YjNvcW02dWFtbzhpeSJ9.EpanROBym2vRINMDfmysig'; 
    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/colbyfox/cle6m689j000301mjf1w0jfip', 
      center: [0, 0],
      zoom: 1
    });

    // Fly to the United States when the map is first loaded
    map.flyTo({ center: [-95, 37], zoom: 4.2, duration: 10000 });

    function setEquityGroupVisibility(equityGroup, isVisible) {
      const visibility = isVisible ? 'visible' : 'none';
      map.setLayoutProperty(`symbols-${equityGroup}`, 'visibility', visibility);
    }

    // Add event listeners for checkboxes
    document.querySelectorAll('.equity-toggle').forEach((checkbox) => {
      checkbox.addEventListener('change', (event) => {
        setEquityGroupVisibility(event.target.value, event.target.checked);
      });
    });

    map.on('load', () => {
      // Get the existing symbol layer from the style
      const symbolsLayer = map.getStyle().layers.find(layer => layer.id === 'symbols');
      
      const equityGroups = ['AEG', 'ECP', 'ESP', 'BCP', 'ECSP', 'WPO'];

      equityGroups.forEach(equityGroup => {
        // Duplicate the symbol layer and apply a filter for each Equity Group
        const newLayer = {
          ...symbolsLayer,
          id: `symbols-${equityGroup}`,
          filter: ['==', ['get', 'Equity Group'], equityGroup]
        };

        // Remove the original layer and add the new filtered layers
        map.removeLayer('symbols');
        map.addLayer(newLayer);
      });
    });
    </script>
  </body>
</html>
